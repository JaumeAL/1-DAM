--1. Crea les taules necessàries amb CREATE TABLE. (5 punts)
CREATE TABLE MINORISTA(
	CIF VARCHAR2(9) CHECK (LENGTH(CIF)=9) PRIMARY KEY,
    NOM VARCHAR2(50) NOT NULL
);

CREATE TABLE PRODUCTE(
	NOM VARCHAR2(50) PRIMARY KEY,
    PREU_UNITARI NUMBER(6,2) NOT NULL
);

CREATE TABLE COMANDA(
	CODI NUMBER GENERATED AS IDENTITY,
    PREU_TOTAL NUMBER(7,2) NOT NULL,
    DADA DATE NOT NULL,
    CIF_MINORISTA VARCHAR2(9) NOT NULL,
    NOM_PRODUCTE VARCHAR2(50) NOT NULL,
    FOREIGN KEY (CIF_MINORISTA) REFERENCES MINORISTA(CIF),
    FOREIGN KEY (NOM_PRODUCTE) REFERENCES PRODUCTE(NOM),
    PRIMARY KEY (CODI)
);

CREATE TABLE REPARTIDOR(
	NUM_SS VARCHAR2(30) PRIMARY KEY,
    NOM VARCHAR2(50) NOT NULL
);

CREATE TABLE INTENT_ENTREGA(
	CODI NUMBER GENERATED AS IDENTITY,
    DADA DATE NOT NULL,
    ESTAT VARCHAR2(20),
    CODI_REPROGRAMAT NUMBER,
    CODI_COMANDA NUMBER,
    NUM_SS_REPARTIDOR VARCHAR2(30),
    FOREIGN KEY (CODI_REPROGRAMAT) REFERENCES INTENT_ENTREGA(CODI),
    FOREIGN KEY (CODI_COMANDA) REFERENCES COMANDA(CODI),
    FOREIGN KEY (NUM_SS_REPARTIDOR) REFERENCES REPARTIDOR(NUM_SS),
    UNIQUE(DADA,CODI_COMANDA),
    PRIMARY KEY (CODI)
);

--2. Introdueix la següent informació (3 punts)
--A. 2 minoristes
INSERT INTO MINORISTA VALUES ('A12345678','Jaume');
INSERT INTO MINORISTA VALUES ('B23456789','Albert');

--B. 2 productes
INSERT INTO PRODUCTE VALUES ('Pantalla', 120.99);
INSERT INTO PRODUCTE VALUES ('Teclat', 40.50);

--C. 1 repartidor
INSERT INTO REPARTIDOR VALUES ('1111111111', 'Hector');

--D. 2 comandes de diferents productes
INSERT INTO COMANDA(PREU_TOTAL,DADA,CIF_MINORISTA,NOM_PRODUCTE) VALUES (240,  TO_DATE('17/01/2025', 'DD/MM/YYYY'),'A12345678','Pantalla');
INSERT INTO COMANDA(PREU_TOTAL,DADA,CIF_MINORISTA,NOM_PRODUCTE) VALUES (40.50,  TO_DATE('16/01/2025', 'DD/MM/YYYY'),'B23456789','Teclat');

--E. 3 intents d’entrega assignats a l’únic repartidor que hi ha:
--a. Un en estat COMPLETAT de qualsevol de les 2 comandes, a una data quasevol.
INSERT INTO INTENT_ENTREGA(DADA,ESTAT,CODI_REPROGRAMAT,CODI_COMANDA,NUM_SS_REPARTIDOR) VALUES (TO_DATE('16/01/2025', 'DD/MM/YYYY'),'COMPLETAT',1,22,'1111111111');

--b. Un en estat REPROGRAMAT de la comanda que no has triat a l’anterior intent, a una data qualsevol.
INSERT INTO INTENT_ENTREGA(DADA,ESTAT,CODI_REPROGRAMAT,CODI_COMANDA,NUM_SS_REPARTIDOR) VALUES (TO_DATE('18/01/2025', 'DD/MM/YYYY'),'REPROGRAMAT',1,3,'1111111111');

--c. Un en estat COMPLETAT que sigui una reprogramació de l’intent d’entrega del punt (b.) anterior i que s’hagi realitzat el dia posterior a aquell.
INSERT INTO INTENT_ENTREGA(DADA,ESTAT,CODI_REPROGRAMAT,CODI_COMANDA,NUM_SS_REPARTIDOR) VALUES (TO_DATE('17/01/2025', 'DD/MM/YYYY'),'COMPLETAT',22,3,'1111111111');
SELECT * FROM INTENT_ENTREGA;
--3. Realitza les següents operacions (2 punts)
--1. Afegeix una columna DESCRIPCIO a la taula Producte, que pugi contenir fins a 2000 caràcters.
ALTER TABLE PRODUCTE ADD DESCRIPCIO VARCHAR2(2000);

--2. Modifica la columna “Data” de INTENT_ENTREGA perquè sigui un TIMESTAMP en lloc d’un DATE. Si l’has creada com a TIMESTAMP, modifica-la perquè sigui un DATE.
ALTER TABLE INTENT_ENTREGA MODIFY DADA TIMESTAMP;

--3. Elimina la columna “Preu unitari” de producte.
ALTER TABLE PRODUCTE DROP COLUMN PREU_UNITARI;

--4. Canvia el nom de qualsevol dels 2 minoristes a “Minorista de prova”
UPDATE MINORISTA SET NOM ='Minorista de prova' WHERE CIF = 'A12345678';

--5. Elimina un intent d’entrega. L’eliminació ha de ser correcta.
DELETE FROM INTENT_ENTREGA WHERE CODI = 1;

--6. Elimina tota la informació de la taula INTENT_ENTREGA.
TRUNCATE TABLE INTENT_ENTREGA;